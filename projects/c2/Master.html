<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">.lst-kix_ujjamiey8xi6-2>li:before{content:"\0025a0  "}ul.lst-kix_ujjamiey8xi6-6{list-style-type:none}ul.lst-kix_ujjamiey8xi6-7{list-style-type:none}.lst-kix_ujjamiey8xi6-1>li:before{content:"\0025cb  "}.lst-kix_ujjamiey8xi6-3>li:before{content:"\0025cf  "}ul.lst-kix_ujjamiey8xi6-4{list-style-type:none}ul.lst-kix_ujjamiey8xi6-5{list-style-type:none}ul.lst-kix_ujjamiey8xi6-2{list-style-type:none}ul.lst-kix_ujjamiey8xi6-3{list-style-type:none}ul.lst-kix_ujjamiey8xi6-0{list-style-type:none}ul.lst-kix_ujjamiey8xi6-1{list-style-type:none}.lst-kix_ujjamiey8xi6-7>li:before{content:"\0025cb  "}.lst-kix_ujjamiey8xi6-0>li:before{content:"\0025cf  "}.lst-kix_ujjamiey8xi6-8>li:before{content:"\0025a0  "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_ujjamiey8xi6-6>li:before{content:"\0025cf  "}.lst-kix_ujjamiey8xi6-5>li:before{content:"\0025a0  "}.lst-kix_ujjamiey8xi6-4>li:before{content:"\0025cb  "}ul.lst-kix_ujjamiey8xi6-8{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c24{background-color:#ffffff;-webkit-text-decoration-skip:none;color:#000000;font-weight:400;text-decoration:underline;vertical-align:baseline;text-decoration-skip-ink:none;font-size:11.5pt;font-family:"Arial";font-style:normal}.c5{margin-left:216pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c4{margin-left:72pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c6{margin-left:180pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c23{margin-left:180pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c9{margin-left:36pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c10{margin-left:72pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c7{margin-left:144pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c2{margin-left:108pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c18{background-color:#ffffff;color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:11.5pt;font-family:"Arial";font-style:italic}.c8{background-color:#ffffff;color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11.5pt;font-family:"Arial";font-style:normal}.c20{margin-left:108pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c3{margin-left:144pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c16{padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c12{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c17{margin-left:72pt;padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c19{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left;height:11pt}.c13{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:italic}.c21{padding-top:0pt;padding-bottom:0pt;line-height:1.1500000000000001;orphans:2;widows:2;text-align:left}.c15{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.c25{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c11{color:inherit;text-decoration:inherit}.c1{padding:0;margin:0}.c26{background-color:#ffffff;font-size:11.5pt}.c14{margin-left:36pt}.c22{margin-left:108pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c25"><div><p class="c12"><span class="c0"></span></p></div><p class="c21"><span class="c0">The Cyber Killchain, for all the hate that it gets, provided a very useful framework for understanding what defense in depth. And while DiD is nice and all, sometimes you don&rsquo;t have the luxury. So let&rsquo;s focus on the easiest place to defend and blue team like it&rsquo;s 1995: defending the firewall. </span></p><p class="c19"><span class="c0"></span></p><p class="c21"><span class="c0">While there are some notable examples of malware that does not require external C2, they&rsquo;re not in your threat model, sorry buttercup. For everything else, there is egress filtering. This is the very general idea that if malware is unable to call home, the process can sit on your network yelling into your firewall as much as it likes and the attacker will not be able to control any further behavior or receive any data. If you can leave malware at the bottom of the well, for all intents and purposes little Timmy no longer is a threat. There are a multitude of ways to do egress filtering but I won&rsquo;t be going into that at all. This piece will be focusing on the multitude of ways C2 servers &ldquo;look&rdquo;, the various methods used for C2, and how those channels behave. </span></p><p class="c19"><span class="c0"></span></p><ul class="c1 lst-kix_ujjamiey8xi6-1 start"><li class="c14 c16 li-bullet-0"><span class="c0">Infrastructure</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c4 li-bullet-0"><span class="c0">Box</span></li><li class="c2 li-bullet-0"><span class="c0">Unlikely you will ever do any detections using this, though there is a tiny chance this could matter if you get active on your defense and scan C2 domains.</span></li><li class="c2 li-bullet-0"><span class="c0">Physical</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Used by everyone and no-one. Simultaneously the easiest and least scalable method of doing things. </span></li><li class="c3 li-bullet-0"><span class="c0">&ldquo;Expose a locally running web server to the internet without having to open up ports in the firewall or even needing a public IP address&rdquo; </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://blog.cloudflare.com/get-started-with-warp/&amp;sa=D&amp;source=editors&amp;ust=1619566883518000&amp;usg=AOvVaw1umLSC1r_3T1fc9Xu6Rdvd">https://blog.cloudflare.com/get-started-with-warp/</a></span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Virtual</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">No reason someone wouldn&rsquo;t run their stuff on a virtualized server, just annoying networking. Makes a ton of sense for people who don&rsquo;t want to do dedicated boxes and won&rsquo;t entrust what they are doing to cloud services.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Cloud</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Somebody else&rsquo;s box. Most scalable, least expensive, probably most commonly used. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Hosting/IP Address</span></li><li class="c2 li-bullet-0"><span class="c0">How does the C2 server connect to the internet?</span></li><li class="c2 li-bullet-0"><span class="c0">Attacker Owned</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Probably doesn&rsquo;t exist&hellip; fastest way to blacklist a block imaginable.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Attacker Pwned</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Stolen Space</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Hijacking IP space is more common than you&rsquo;d think, and can be used to get high trust IP space which might beat some reputation heuristics.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Hijacked Site</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Any time an attacker can hijack a site or use it as a redirector they will because it is one of the highest quality reputations a site can have which will beat heuristics until reported and analysed. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">3rd Party</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Renting Public</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Renting hosting from various cloud service providers is the most common option because it keeps your IP block relatively high trust if you use high quality mainstream providers which respond to abuse complaints.</span></li><li class="c6 li-bullet-0"><span class="c0">Various &ldquo;bullet proof hosting&rdquo; services exist which will serve anything from C2 to CP, but they have shit reputation so useless if your target does anything using reputation.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Exposing Local</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">You can also use script shenaniganery or things like Warp to expose local assets to a public IP</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-5 start"><li class="c5 li-bullet-0"><span class="c0">https://blog.cloudflare.com/get-started-with-warp/</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c4 li-bullet-0"><span class="c0">Domain</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c2 li-bullet-0"><span class="c0">Attacker Owned</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">New</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Attackers can register a domain for whatever they want and use that for C2. Drawbacks are that because it is new, reputation is low.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Expired</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Attackers can search for recently expired sites using various tools. After finding these expired sites they can be re-registered and clone from Internet Archive or just have new content throw on top. This inherits the domain reputation of the previous domain unless whatever rep system being used is significantly advanced.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Attacker Pwned</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Hijacked Site</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Overt</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-5 start"><li class="c5 li-bullet-0"><span class="c0">Hackers can take over a site and replace it with their C2 server. This is easiest but very loud and will likely result in the site being burned down. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4"><li class="c6 li-bullet-0"><span class="c0">Covert</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-5 start"><li class="c5 li-bullet-0"><span class="c0">Plenty of times, website owners will not know there site is being used for C2 or various other malicious activities until it has been suspended by their host. If an attacker wants to use a compromised site like a wordpress they will, and there is very little the average site maintainer can do about it.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">3rd Party</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">The most dangerous of all, malware communicates through a 3rd party site without any compromise or negative effect on the site, simply using the site&rsquo;s built in features. More details on this later.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c4 li-bullet-0"><span class="c0">Domain Resolution&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c2 li-bullet-0"><span class="c0">Hardcoded</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">IP(s)</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Sometimes malware will call home to a hardcoded IP address to avoid having to use DNS. This is loud and ugly and stands out to the blue team, not to mention is a really bad way to do long term C2.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Domain(s)</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Most frequently malware will have a domain name or names that it will resolve in order to communicate. This makes it look like any other traffic on a computer and much more difficult to notice. </span></li><li class="c6 li-bullet-0"><span class="c0">Fast Flux</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-5 start"><li class="c5 li-bullet-0"><span class="c0">Fast flux is a technique used by malware to have multiple IP addresses associated with a domain name in order to defeat standard IP ACLs. If blue is looking for it, this is very loud. Domain blacklists still work fine and this is easily mitigated.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c4 li-bullet-0"><span class="c0">Domain Rotation </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c2 li-bullet-0"><span class="c0">Set </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">The basic and boring, one domain is used for all communications, making it very high frequency.. If this domain is blocked, that&rsquo;s all folks. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Rotating</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Multiple domains are used and rotated between in a pseudo-random fashion, significantly decreasing the frequency and in general how loud the C2 is. As long as one of the domains remains unblocked, C2 will continue.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Tiered</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Basic logic in a piece of malware to move to a secondary domain if the primary domain is blocked. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Dynamic Updates</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Ability for a malware controller to push a new set of C2 domains in order to maintain comms.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">DGA</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Domain generation algorithm based off of a random seed that generates potential domains that malware tries to call back to. If the attacker has registered this domain, the malware connects and is back under control. If the domain is not registered, NXdomain is returned and nothing happens. Reversing DGAs allows defenders to pre-emptively block DGA domains or in some cases register them ahead of attackers in order to track the size of botnets. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Segmentation</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Single</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">The dumb way to do C2, use a single node for every single function. If this gets blocked. Everything gets blocked. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Recon/C2/Lateral Movement/Exfiltration</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Smart way to handle this is to switch between channels based off what needs to occur. By using different infrastructure between stages, an attacker can hide what they have been doing. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Centralization</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Centralized</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">All the malware calls back to a single control server. Benefits, easy. Negatives, easy to block single control server. </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Decentralized</span></li><li class="c3 li-bullet-0"><span class="c0">P2P</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">I don&rsquo;t know enough.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Physical</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">USBs ala Flame</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Connection</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Unproxied</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Connection is made straight through to C2 server</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Proxied</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Connection is proxied using ___</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Redirected</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Connection is redirected using _____</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">TOR2Web</span></li><li class="c2 li-bullet-0"><span class="c0">TOR</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c16 c14 li-bullet-0"><span class="c0">Malware</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c2 li-bullet-0"><span class="c0">Staged</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Staged</span></li><li class="c3 li-bullet-0"><span class="c0">Stage Less</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Dropper/Loader</span></li><li class="c2 li-bullet-0"><span class="c0">Requests</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Raw Sockets</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Uses raw sockets implemented in a low level programming language to communicate</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native api</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Uses operating system&rsquo;s api to make calls</span></li><li class="c6 li-bullet-0"><span class="c0">Wininet &amp; </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native functions</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Uses os&rsquo; lower level functions</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native scripting language</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Uses host computers scripting ability</span></li><li class="c6 li-bullet-0"><span class="c0">Powershell, wmi, bash, python</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Non native</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Malware brings their own library to make calls</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c0">Actions</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c0">Malware will have a little bit of each for various tasks</span></li><li class="c3 li-bullet-0"><span class="c0">Raw</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Low level coding, custom &nbsp;</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native Library</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Use native library</span></li><li class="c6 li-bullet-0"><span class="c0">High level coding </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native tools</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Uses built in tools to accomplish actions on objective</span></li><li class="c6 li-bullet-0"><span class="c0">Powershell stuff</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Native Scripting Language</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Scripting capability, high level</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c3 li-bullet-0"><span class="c0">Non-Native Library</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Brings their own libraries for custom behaviors</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c16 c14 li-bullet-0"><span class="c0">Channel</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c4 li-bullet-0"><span class="c0">Conversation</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Synchronous</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Standard call/response, action completed, response sent </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Asynchronous</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Where the magic happens</span></li><li class="c6 li-bullet-0"><span class="c0">Commands and actions occur independently, allows for greater flexibility</span></li><li class="c6 li-bullet-0"><span class="c0">Callbacks happen whenever the implant feels like it</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Direction</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Internal to Internal</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Lateral movement</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Internal to External</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Command and control</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">External to Internal</span></li></ul><p class="c19"><span class="c0"></span></p><ul class="c1 lst-kix_ujjamiey8xi6-4"><li class="c6 li-bullet-0"><span class="c0">Backdoor</span></li><li class="c6 li-bullet-0"><span class="c0">Really bad firewalls, webshells</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Stealth</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Overt</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Does not attempt to hide</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Benign</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Attempts to look like normal traffic</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Covert</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Normal traffic with hidden channel</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Encryption</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Plain Text</span></li><li class="c2 li-bullet-0"><span class="c0">Encoded</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c3 li-bullet-0"><span class="c0">Encoding Type</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Encrypted</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c3 li-bullet-0"><span class="c0">Encryption Type</span></li><li class="c3 li-bullet-0"><span class="c0">Certificate</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Traffic</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">IPV4</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Standard rfc compliant</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">IPV6</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Ipv6 and teredo tunneling breaks bad firewalls</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Non-Compliant</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Not rfc compliant traffic </span></li><li class="c6 li-bullet-0"><span class="c0">Can break monitoring software</span></li><li class="c6 li-bullet-0"><span class="c0">Most types of covert channels</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Switching</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Static Channel</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Channel does not change behaviors</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Activity Aware Channel</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Channel is only active while computer is active</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c0">Dynamic Channel Switching</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c0">Implant intelligently switches between channels by type of activity </span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c8">DefaultLostLimit</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c3 li-bullet-0"><span class="c8">Automatically stop sending callbacks to a c2 node after enough have been lost, most likely because node was blocked. This behavior makes the implant more difficult to detect because it isnt pinging out for no reason</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c2 li-bullet-0"><span class="c24">Domain Rotation</span></li></ul><p class="c19 c22"><span class="c8"></span></p><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c0">Handshakes</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c0">Registration</span></li><li class="c3 li-bullet-0"><span class="c0">First beacon registers new device</span></li><li class="c2 li-bullet-0"><span class="c0">Port Knock</span></li><li class="c3 li-bullet-0"><span class="c0">Just some bull</span></li><li class="c2 li-bullet-0"><span class="c0">Custom TCP Stacks</span></li><li class="c3 li-bullet-0"><span class="c0">Special Handshakes or some other sort of shenanigans that allows the C2 server to identify how to handle incoming traffic</span></li><li class="c2 li-bullet-0"><span class="c0">Predefined SSL certs</span></li><li class="c3 li-bullet-0"><span class="c0">Easy way to allow selective treatment for C2</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c4 li-bullet-0"><span class="c26">Temporal Characteristics</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c2 li-bullet-0"><span class="c8">DefaultDelay</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c8">First callback occurs on a time delay in order to defeat analysis/sandboxes</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c8">KillDate</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c8">Automatically kill a c2 node after a set period of time in order to keep count down</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c8">WorkingHours</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c8">Only operate node during target working hours</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c8">Periodicity</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c8">Frequency that an implant checks for commands and sends information out. The higher the frequency, the greater the interactivity and amount of data that can be sent out and in. However, the more traffic the greater the likelihood of detection. In addition, defenders can look for a high degree of periodicity in domain requests and use that to detect. </span></li><li class="c6 li-bullet-0"><span class="c8">Keep in mind that if malware uses rotating domains, periodicity will not be exact</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-5 start"><li class="c5 li-bullet-0"><span class="c8">If it is a dumb rotation, it will still be periodic</span></li><li class="c5 li-bullet-0"><span class="c8">If it is a pseduorandom rotation, there will be no discernible periodicity in the short term, will be some in the long term. </span></li><li class="c5 li-bullet-0"><span class="c18">Author&rsquo;s Note: I really should demonstrate this with fake data&hellip; shouldn&rsquo;t be too hard.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c2 li-bullet-0"><span class="c8">DefaultJitter</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c6 li-bullet-0"><span class="c8">A percentage that is used to multiply the chosen periodicity by in order to create a plus or minus jitter in order to defeat periodicity detection. On the plus side for defenders, unless jitter is 100%, this will create a very noticeable high and low limit to periodicity over time that rules can be written for.</span></li></ul><p class="c17"><span class="c8">&nbsp;</span></p><ul class="c1 lst-kix_ujjamiey8xi6-1"><li class="c16 c14 li-bullet-0"><span class="c8">Methods</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2 start"><li class="c10 li-bullet-0"><span>HTTP/S</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c20 li-bullet-0"><span class="c0">Subdomain</span></li><li class="c20 li-bullet-0"><span class="c0">Uri</span></li><li class="c20 li-bullet-0"><span class="c0">Request</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c7 li-bullet-0"><span class="c0">Stand Alone</span></li><li class="c7 li-bullet-0"><span class="c0">On page</span></li><li class="c7 li-bullet-0"><span class="c0">Stegoed</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3"><li class="c20 li-bullet-0"><span class="c0">3rd Party</span></li><li class="c20 li-bullet-0"><span class="c0">Other</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-4 start"><li class="c7 li-bullet-0"><span class="c0">API</span></li><li class="c23 li-bullet-0"><span class="c0">Soap/Rest/whatever</span></li><li class="c7 li-bullet-0"><span class="c0">User Agent</span></li><li class="c7 li-bullet-0"><span class="c0">Cookies</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c10 li-bullet-0"><span class="c0">DNS</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c20 li-bullet-0"><span class="c0">TXT or Other</span></li><li class="c20 li-bullet-0"><span class="c0">Subdomain</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c10 li-bullet-0"><span class="c0">ICMP</span></li><li class="c10 li-bullet-0"><span class="c0">FTP</span></li><li class="c10 li-bullet-0"><span class="c0">Reverse Shells</span></li><li class="c10 li-bullet-0"><span class="c0">Webshells</span></li><li class="c10 li-bullet-0"><span class="c0">Other</span></li><li class="c10 li-bullet-0"><span class="c0">Covert Channels</span></li><li class="c20 li-bullet-0"><span class="c0">Shannon Entropy</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-3 start"><li class="c7 li-bullet-0"><span class="c0">Higher the entropy, greater the amount of data that gets through</span></li><li class="c20 li-bullet-0"><span class="c0">Timing</span></li><li class="c20 li-bullet-0"><span class="c0">Caching</span></li><li class="c20 li-bullet-0"><span class="c0">Headers</span></li><li class="c20 li-bullet-0"><span class="c0">Bit Flips</span></li><li class="c7 li-bullet-0"><span class="c0">Good luck buddy.</span></li></ul><ul class="c1 lst-kix_ujjamiey8xi6-2"><li class="c10 li-bullet-0"><span class="c0">Obfuscated</span></li></ul><p class="c12 c14"><span class="c0"></span></p><p class="c19 c14"><span class="c0"></span></p><ul class="c1 lst-kix_ujjamiey8xi6-0 start"><li class="c9 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://docs.google.com/document/d/1szIAFgt2NubsPOrFgURixZxi29yxfFu1sY2pndq_0ac/edit&amp;sa=D&amp;source=editors&amp;ust=1619566883539000&amp;usg=AOvVaw1q-qm41NOqRiX-QEWcjb5j">Links to Methods</a></span></li><li class="c9 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://docs.google.com/document/d/1u1kmAnaQ2fY8-Wku-nUVYTolnizPx--1D28epBiDIRQ/edit&amp;sa=D&amp;source=editors&amp;ust=1619566883539000&amp;usg=AOvVaw2JAO3BaY_FZAhjoJNp5Jcn">List O&rsquo; Features</a></span><span class="c0">&nbsp;</span></li><li class="c9 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://docs.google.com/presentation/d/1pT16ZkXoSxfTMJ7wAKuzHqVEwXs7euAnZBn41V3wE2A/edit%23slide%3Did.p63&amp;sa=D&amp;source=editors&amp;ust=1619566883540000&amp;usg=AOvVaw0xXo86NbAnSVxkRNhUwu4o">Links to Learning</a></span></li><li class="c9 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://docs.google.com/document/d/1l1XGMISq1QWDr7Jpo0Zcp14pz2AiLVlzukeW7uB7RJk/edit&amp;sa=D&amp;source=editors&amp;ust=1619566883541000&amp;usg=AOvVaw3d351cX6pFvlSWYjOzByIW">List of Random Malwares</a></span></li><li class="c9 li-bullet-0"><span class="c15"><a class="c11" href="https://www.google.com/url?q=https://docs.google.com/document/d/1Pvx7LFhPa8ry1rW8dBLmMQ-PVt_QF-GY_W-Xg8ed7eo/edit&amp;sa=D&amp;source=editors&amp;ust=1619566883542000&amp;usg=AOvVaw1NdON_nGVfJhfOaWiUEpqh">List of &nbsp;High Fidelity Detections</a></span></li></ul><p class="c12"><span class="c0"></span></p></body></html>